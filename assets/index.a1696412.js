import{G as e}from"./vendor.34f1e898.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(o){const r=new URL(e,location),s=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((o,n)=>{const a=new URL(e,r);if(self[t].moduleMap[a])return o(self[t].moduleMap[a]);const c=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){n(new Error(`Failed to import: ${e}`)),s(i)},onload(){o(self[t].moduleMap[a]),s(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("assets/");let t=!1;const o=new Map;let r;const s=()=>{t=!1;for(const[e,t]of o.entries())r.setProperty(`--${e}`,t);o.clear()},n=()=>{t||requestAnimationFrame(s),t=!0},a=(e,t)=>{o.set(e,t),n()},c=e=>{for(const[t,r]of Object.entries(e))o.set(t,r);n()},i=e=>{for(const[t,o]of Object.entries(e))r.setProperty(`--${t}`,o)},l=new Proxy({},{get:(e,t)=>(Reflect.has(e,t)||(e[t]=[],p(t)),e[t])}),d=["wheel"],p=e=>{document.addEventListener(e,(t=>{for(const o of l[e]){if(!1===Reflect.apply(o,void 0,[t]))return;!d.includes(e)&&Reflect.has(t,"preventDefault")&&t.preventDefault()}}))},m=e=>e[0].map(((t,o)=>e.map((e=>e[o])).reverse()));let u,f={cols:4,rows:4,floors:5};f=new Proxy(f,{set:(e,t,o)=>(e[t]=o,a(t,String(o)),k(),S(),!0)});const v={orangeRick:[[0,0,1,0],[1,1,1,0]],hero:[[1,1,1,1],[0,0,0,0]],blueRick:[[1,0,0,0],[1,1,1,0]],teeWee:[[0,1,0,0],[1,1,1,0]],clevelandZ:[[1,1,0,0],[0,1,1,0]],smashboy:[[1,1,0,0],[1,1,0,0]],rhodeIslandZ:[[0,1,1,0],[1,1,0,0]]};Object.freeze(v);const h=(e,t=0,o=0,r)=>{let s=v[R.tetromino],n=(R.rotZ+e)/90;switch(Math.abs(n)>=4&&(n%=4),n<0&&(n=4+n),n){case 1:t-=2;break;case 2:t-=4,o-=2;break;case 3:o-=4}for(let a=0;a<n;a++)s=m(s);for(let a=0;a<s[0].length;a++)for(let e=0;e<s.length;e++)if(s[e][a]){if(!r(a+t+R.posX,e+o+R.posY))return!1}return!0},w=(e,t=0,o=0)=>h(e,t,o,((e,t)=>!(e<0||e>=f.cols)&&!(t<0||t>=f.rows))),y=e=>{let t=R.rotX+e;console.log("Rotate X",t)},g=e=>{const t=[0,-1,1,-2,2,-3,3,-4,4];for(const o of t)for(const r of t)w(e,o,r)&&(R.posX+=o,R.posY+=r,R.rotZ+=e)},b=e=>{w(0,e)&&(R.posX+=e)},F=e=>{w(0,0,e)&&(R.posY+=e)},L={set:(e,t,o)=>{switch(t){case"live":clearInterval(u),o&&(u=setInterval(x,3e3));break;case"tetromino":R.tetromino?document.querySelector(".tetromino").classList.replace(R.tetromino,o):document.querySelector(".tetromino").classList.add(o);break;default:a(t,String(o))}return e[t]=o,!0}};let M,R={live:!1};R=new Proxy(R,L);const k=()=>{M=Array.from(Array.from({length:f.floors},(()=>Array.from({length:f.rows},(()=>Array.from({length:f.cols},(()=>0))))))),R.live&&(u=setInterval(x,3e3))},$=()=>{return(e=Reflect.ownKeys(v))[Math.floor(Math.random()*e.length)];var e},X=()=>{R.currentFloor=f.floors-1,R.tetromino=$(),R.posX=0,R.posY=0,R.rotX=0,R.rotZ=0},j=()=>{const e=document.createDocumentFragment();h(0,0,0,((t,o)=>{M[R.currentFloor][o][t]=1;const r=(s="mc",document.querySelector(`.pool > .${s}`).cloneNode(!0));var s;return r.classList.add(`floor${R.currentFloor}`),r.style.transform=`translate3d(calc(var(--edge) * ${t}), calc(var(--edge) * ${o}), calc(var(--edge) * ${R.currentFloor}))`,e.appendChild(r),!0}));const t=document.querySelector(".mason");t.appendChild(e),R.currentFloor+1===f.floors-1&&(clearInterval(u),(async e=>{if("Notification"in window&&"denied"!==Notification.permission&&("default"!==Notification.permission||"denied"!==await Notification.requestPermission()))"granted"===Notification.permission&&new Notification(e)})("You Died! (×﹏×)"),(e=>{for(;e.firstChild;)e.removeChild(e.lastChild)})(t),f.cols++,f.rows++,f.floors++,k())},x=(e=-1)=>{R.currentFloor+=e,0!==R.currentFloor&&h(0,0,0,((e,t)=>!M[R.currentFloor-1][t][e]))||(j(),X())};let K,Y=!1;let A,O={edge:0,perspective:0};O=new Proxy(O,{set:(e,t,o)=>(e[t]=o,a(t,`${o}px`),!0)});const S=()=>{const e=A.clientWidth/f.cols,t=A.clientHeight/f.rows;O.edge=Math.min(e,t)/2,O.perspective=f.floors*O.edge*2},E=()=>{c({perspectiveX:"50%",perspectiveY:"50%"}),S()},P=(e,t,o)=>{let r=(s=A.clientWidth,e/s*100);var s;return r>100-t?r+=Math.pow(Math.abs(100-t-r),o):r<t&&(r-=Math.pow(t-r,o)),r},q=(e,t=10,o=2)=>{if(Y)return void E();let r=100-P(e.clientX,t,o)+"%",s=100-P(e.clientY,t,o)+"%";c({perspectiveX:r,perspectiveY:s})},D=({deltaY:e})=>{let t=((e,t)=>{const o=r.getPropertyValue(`--${e}`);return void 0===t?o:t(o)})("perspective",parseFloat);t+=Math.sign(e)*(t<100?1:~~Math.sqrt(t-100+1)),t>0&&a("perspective",`${t}px`)},N=e=>{if(e.ctrlKey)return;const t=e.metaKey||e.shiftKey||e.altKey;switch(e.code){case"KeyQ":x(1);break;case"KeyE":x();break;case"KeyA":case"ArrowLeft":t?g(-90):b(-1);break;case"KeyD":case"ArrowRight":t?g(90):b(1);break;case"KeyW":case"ArrowUp":t?y(90):F(-1);break;case"KeyS":case"ArrowDown":t?y(-90):F(1)}return!1};window.addEventListener("load",(()=>{const t=document.querySelector(".container");A=t,S(),(e=>(r=e.style,i))(t)(Object.assign({perspectiveX:"50%",perspectiveY:"50%",radius:"0px"},...Object.entries(f).map((([e,t])=>({[e]:String(t)}))))),new ResizeObserver(S).observe(A),l.keydown.push(N),l.mouseup.push(E),l.mousedown.push(q),l.mousemove.push(q),l.wheel.push(D),l.mousedown.push((e=>{3===e.buttons&&(O.perspective=O.perspective*f.floors/350)})),X(),k(),(()=>{K=new e,K.close(),K.domElement.addEventListener("mousedown",(()=>Y=!0)),K.domElement.addEventListener("mouseup",(()=>Y=!1));const t=K.addFolder("Dimensions");t.add(f,"cols").min(4).max(50).step(1).listen(),t.add(f,"rows").min(4).max(50).step(1).listen(),t.add(f,"floors").min(4).max(50).step(1).listen(),t.open();const o=K.addFolder("Layout");o.add(O,"edge").min(1).step(1).listen(),o.add(O,"perspective").min(0).step(1).listen(),o.open();const r=K.addFolder("State");r.add(R,"live").listen(),r.add(R,"currentFloor").step(1).listen(),r.add(R,"tetromino").options(Object.keys(v)).listen(),r.add(R,"posX").step(1).listen(),r.add(R,"posY").step(1).listen(),r.add(R,"rotX").step(1).listen(),r.add(R,"rotZ").step(1).listen(),r.open()})()}));
