import{G as e}from"./vendor.34f1e898.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(o){const r=new URL(e,location),s=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((o,n)=>{const c=new URL(e,r);if(self[t].moduleMap[c])return o(self[t].moduleMap[c]);const l=new Blob([`import * as m from '${c}';`,`${t}.moduleMap['${c}']=m;`],{type:"text/javascript"}),a=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(l),onerror(){n(new Error(`Failed to import: ${e}`)),s(a)},onload(){o(self[t].moduleMap[c]),s(a)}});document.head.appendChild(a)})),self[t].moduleMap={}}}("assets/");let t=!1;const o=new Map;let r;const s=()=>{t=!1;for(const[e,t]of o.entries())r.setProperty(`--${e}`,t);o.clear()},n=()=>{t||requestAnimationFrame(s),t=!0},c=(e,t)=>{o.set(e,t),n()},l=(e,t=!1)=>{if(t)for(const[o,s]of Object.entries(e))r.setProperty(`--${o}`,s);else{for(const[t,r]of Object.entries(e))o.set(t,r);n()}},a=e=>e[0].map(((t,o)=>e.map((e=>e[o])).reverse()));let i,d={cols:4,rows:4,floors:5};d=new Proxy(d,{set:(e,t,o)=>(e[t]=o,c(t,String(o)),p(),f(),!0)});const p=()=>{i=Array.from(Array.from({length:d.floors},(()=>Array.from({length:d.rows},(()=>Array.from({length:d.cols},(()=>0)))))))};let u,m={edge:0,perspective:0};m=new Proxy(m,{set:(e,t,o)=>(e[t]=o,c(t,`${o}px`),!0)});const f=()=>{const e=u.clientWidth/d.cols,t=u.clientHeight/d.rows;m.edge=Math.min(e,t)/2,m.perspective=d.floors*m.edge*2},v=()=>{l({perspectiveX:"50%",perspectiveY:"50%"}),f()},h=(e,t,o)=>{let r=(s=u.clientWidth,e/s*100);var s;return r>100-t?r+=Math.pow(Math.abs(100-t-r),o):r<t&&(r-=Math.pow(t-r,o)),r},w=(e,t=10,o=2)=>{if(!e.ctrlKey)return;const r=100-h(e.clientX,t,o)+"%",s=100-h(e.clientY,t,o)+"%";l({perspectiveX:r,perspectiveY:s})},y=({deltaY:e})=>{let t=((e,t)=>{const o=r.getPropertyValue(`--${e}`);return void 0===t?o:t(o)})("perspective",parseFloat);t+=Math.sign(e)*(t<100?1:~~Math.sqrt(t-100+1)),t>0&&c("perspective",`${t}px`)},g=new Proxy({},{get:(e,t)=>(Reflect.has(e,t)||(e[t]=[],F(t)),e[t])}),b=["wheel"],F=e=>{document.addEventListener(e,(t=>{for(const o of g[e]){if(!1===Reflect.apply(o,void 0,[t]))return;!b.includes(e)&&Reflect.has(t,"preventDefault")&&t.preventDefault()}}))};let k={live:!1};k=new Proxy(k,{set:(e,t,o)=>{const r=k.tetromino;switch(e[t]=o,t){case"live":K();break;case"tetromino":const{classList:e}=document.querySelector(".tetromino");e.contains(r)?e.replace(r,k.tetromino):e.add(k.tetromino);break;default:c(t,String(o))}return!0}});const M={orangeRick:[[0,0,1,0],[1,1,1,0]],hero:[[1,1,1,1],[0,0,0,0]],blueRick:[[1,0,0,0],[1,1,1,0]],teeWee:[[0,1,0,0],[1,1,1,0]],clevelandZ:[[1,1,0,0],[0,1,1,0]],smashboy:[[1,1,0,0],[1,1,0,0]],rhodeIslandZ:[[0,1,1,0],[1,1,0,0]]};Object.freeze(M);const R=(e,t=0,o=0,r)=>{let s=M[k.tetromino],n=(k.rotZ+e)/90;switch(Math.abs(n)>=4&&(n%=4),n<0&&(n=4+n),n){case 1:t-=2;break;case 2:t-=4,o-=2;break;case 3:o-=4}for(let c=0;c<n;c++)s=a(s);for(let c=0;c<s[0].length;c++)for(let e=0;e<s.length;e++)if(s[e][c]){if(!r(c+t+k.posX,e+o+k.posY))return!1}return!0},$=()=>{return(e=Reflect.ownKeys(M))[Math.floor(Math.random()*e.length)];var e};let X;const K=()=>{clearInterval(X),k.live&&(X=setInterval(S,3e3))},L=()=>{k.currentFloor=d.floors-1,k.tetromino=$(),k.posX=0,k.posY=0,k.rotX=0,k.rotZ=0},j=(e,t=0,o=0)=>R(e,t,o,((e,t)=>!(e<0||e>=d.cols)&&!(t<0||t>=d.rows))),Y=e=>{const t=k.rotX+e;console.log("Rotate X",t)},x=e=>{const t=[0,-1,1,-2,2,-3,3,-4,4];for(const o of t)for(const r of t)if(j(e,o,r))return k.posX+=o,k.posY+=r,void(k.rotZ+=e)},A=e=>{j(0,e)&&(k.posX+=e)},O=e=>{j(0,0,e)&&(k.posY+=e)},P=()=>{const e=document.createDocumentFragment();R(0,0,0,((t,o)=>{i[k.currentFloor][o][t]=1;const r=(s="mc",document.querySelector(`.pool > .${s}`).cloneNode(!0));var s;return r.classList.add(`floor${k.currentFloor}`),r.style.transform=`translate3d(calc(var(--edge) * ${t}), calc(var(--edge) * ${o}), calc(var(--edge) * ${k.currentFloor}))`,e.appendChild(r),!0}));const t=document.querySelector(".mason");t.appendChild(e),k.currentFloor+1===d.floors-1&&(clearInterval(X),(async e=>{if("default"!==Notification.permission||"denied"!==await Notification.requestPermission()){if("denied"!==Notification.permission)return"granted"===Notification.permission?new Notification(e):void 0;alert(e)}else console.warn("Will alert instead")})("You Died! (×﹏×)"),(e=>{for(;e.firstChild;)e.removeChild(e.lastChild)})(t),d.cols++,d.rows++,d.floors++,p(),k.live&&(X=setInterval(S,3e3)))},S=(e=-1)=>{k.currentFloor+=e,console.log([k.currentFloor,d.floors]),(0===k.currentFloor||k.currentFloor>=d.floors||!R(0,0,0,((e,t)=>!i[k.currentFloor-1][t][e])))&&(P(),L())},q=e=>{if(e.ctrlKey)return;const t=e.metaKey||e.shiftKey||e.altKey;switch(e.code){case"KeyQ":S(1);break;case"KeyE":S();break;case"KeyA":case"ArrowLeft":t?x(-90):A(-1);break;case"KeyD":case"ArrowRight":t?x(90):A(1);break;case"KeyW":case"ArrowUp":t?Y(90):O(-1);break;case"KeyS":case"ArrowDown":t?Y(-90):O(1)}return!1},C=()=>{g.keydown.push(q),g.mouseup.push(v),g.mousedown.push(w),g.mousemove.push(w),g.wheel.push(y),g.keyup.push((({key:e})=>{"Control"===e&&v()})),g.mousedown.push((({buttons:e})=>{3===e&&(m.perspective=m.perspective*d.floors/350)}))};let D;window.addEventListener("load",(()=>{const t=document.querySelector(".container");(e=>{r=e})(t.style),l(Object.assign({perspectiveX:"50%",perspectiveY:"50%"},...Object.entries(d).map((([e,t])=>({[e]:String(t)})))),!0),u=t,f(),new ResizeObserver(f).observe(u),C(),p(),L(),(()=>{D=new e,D.close();const t=D.addFolder("Dimensions");t.add(d,"cols").min(4).max(50).step(1).listen(),t.add(d,"rows").min(4).max(50).step(1).listen(),t.add(d,"floors").min(4).max(50).step(1).listen(),t.open();const o=D.addFolder("Layout");o.add(m,"edge").min(1).step(1).listen(),o.add(m,"perspective").min(0).step(1).listen(),o.open();const r=D.addFolder("State");r.add(k,"live").listen(),r.add(k,"currentFloor").step(1).listen(),r.add(k,"tetromino").options(Object.keys(M)).listen(),r.add(k,"posX").step(1).listen(),r.add(k,"posY").step(1).listen(),r.add(k,"rotX").step(1).listen(),r.add(k,"rotZ").step(1).listen(),r.open()})()}));
